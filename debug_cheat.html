<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TinyWaste - 金手指调试版</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #1a1a1a;
            color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #2a2a2a;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        h1 {
            color: #ff9900;
            margin-bottom: 30px;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background-color: #ff9900;
            color: #000;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            margin: 10px;
            transition: background-color 0.3s;
            cursor: pointer;
        }
        
        .btn:hover {
            background-color: #ffb340;
        }
        
        pre {
            background-color: #333;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        .code {
            font-family: monospace;
            color: #ffcc00;
        }
        
        .log {
            height: 300px;
            overflow-y: auto;
            background-color: #333;
            padding: 10px;
            border-radius: 5px;
            margin-top: 20px;
            font-family: monospace;
        }
        
        .log-entry {
            margin-bottom: 5px;
            border-bottom: 1px solid #444;
            padding-bottom: 5px;
        }
        
        .success {
            color: #4caf50;
        }
        
        .error {
            color: #f44336;
        }
        
        .warning {
            color: #ff9800;
        }
        
        .info {
            color: #2196f3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>TinyWaste 金手指调试工具</h1>
        
        <p>这个工具用于调试金手指功能，确保它能正确加载和运行。</p>
        
        <div>
            <button id="loadGameBtn" class="btn">加载游戏</button>
            <button id="testCheatBtn" class="btn">测试金手指</button>
            <button id="clearLogBtn" class="btn">清空日志</button>
        </div>
        
        <h2>调试日志</h2>
        <div id="log" class="log"></div>
        
        <h2>快速命令</h2>
        <pre class="code">// 查看金手指帮助
cheat.help()

// 显示金手指状态
cheat.status()

// 切换金手指面板
cheat.toggle()

// 最大化所有属性
cheat.maxAll()</pre>
    </div>
    
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script>
        // 日志功能
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        // 清空日志
        document.getElementById('clearLogBtn').addEventListener('click', function() {
            document.getElementById('log').innerHTML = '';
            log('日志已清空', 'info');
        });
        
        // 加载游戏
        document.getElementById('loadGameBtn').addEventListener('click', function() {
            log('正在加载游戏...', 'info');
            
            // 创建iframe加载游戏
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = 'index.html';
            document.body.appendChild(iframe);
            
            // 监听iframe加载完成
            iframe.onload = function() {
                log('游戏页面已加载', 'success');
                
                // 检查游戏是否初始化
                const checkGame = setInterval(function() {
                    try {
                        if (iframe.contentWindow.PLAYER_STATUS && iframe.contentWindow.STATUS_LIST) {
                            log('游戏已初始化', 'success');
                            clearInterval(checkGame);
                            
                            // 检查金手指是否加载
                            if (iframe.contentWindow.cheat) {
                                log('金手指已加载', 'success');
                                window.gameFrame = iframe.contentWindow;
                            } else {
                                log('金手指未加载，尝试手动加载', 'warning');
                                
                                // 手动加载金手指
                                const script = iframe.contentDocument.createElement('script');
                                script.src = './data/cheat.js';
                                iframe.contentDocument.head.appendChild(script);
                                
                                script.onload = function() {
                                    log('金手指脚本已手动加载', 'success');
                                    window.gameFrame = iframe.contentWindow;
                                };
                                
                                script.onerror = function() {
                                    log('金手指脚本加载失败', 'error');
                                };
                            }
                        }
                    } catch (e) {
                        log('检查游戏状态出错: ' + e.message, 'error');
                    }
                }, 1000);
            };
            
            iframe.onerror = function() {
                log('游戏页面加载失败', 'error');
            };
        });
        
        // 测试金手指
        document.getElementById('testCheatBtn').addEventListener('click', function() {
            if (!window.gameFrame) {
                log('游戏尚未加载，请先点击"加载游戏"按钮', 'warning');
                return;
            }
            
            try {
                if (window.gameFrame.cheat) {
                    log('金手指对象存在', 'success');
                    
                    // 测试金手指功能
                    if (typeof window.gameFrame.cheat.help === 'function') {
                        log('cheat.help() 函数可用', 'success');
                    } else {
                        log('cheat.help() 函数不可用', 'error');
                    }
                    
                    if (typeof window.gameFrame.cheat.status === 'function') {
                        log('cheat.status() 函数可用', 'success');
                    } else {
                        log('cheat.status() 函数不可用', 'error');
                    }
                    
                    if (typeof window.gameFrame.cheat.toggle === 'function') {
                        log('cheat.toggle() 函数可用', 'success');
                    } else {
                        log('cheat.toggle() 函数不可用', 'error');
                    }
                    
                    if (typeof window.gameFrame.cheat.maxAll === 'function') {
                        log('cheat.maxAll() 函数可用', 'success');
                    } else {
                        log('cheat.maxAll() 函数不可用', 'error');
                    }
                    
                    // 测试UI元素
                    if (window.gameFrame.document.getElementById('cheatEmojiBtn')) {
                        log('金手指按钮存在', 'success');
                    } else {
                        log('金手指按钮不存在', 'error');
                    }
                    
                    if (window.gameFrame.document.getElementById('cheatPanel')) {
                        log('金手指面板存在', 'success');
                    } else {
                        log('金手指面板不存在', 'error');
                    }
                } else {
                    log('金手指对象不存在', 'error');
                }
            } catch (e) {
                log('测试金手指出错: ' + e.message, 'error');
            }
        });
        
        // 初始化日志
        log('调试工具已加载', 'info');
        log('点击"加载游戏"按钮开始测试', 'info');
    </script>
</body>
</html>
